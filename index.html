<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YouTube Channel Verifier</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 800px;
            }
            body {
                padding: 20px;
            }
        }

        .header {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header.has-data {
            display: none;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .header p {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .upload-area {
            margin-top: 15px;
        }

        .upload-area input[type="file"] {
            display: block;
            margin-bottom: 10px;
            width: 100%;
            padding: 10px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 14px;
        }

        .upload-area textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 2px dashed #ccc;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }

        .upload-area button {
            margin-top: 10px;
            padding: 15px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            touch-action: manipulation;
        }

        .upload-area button:active {
            background: #5568d3;
            transform: scale(0.98);
        }

        .progress {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: none;
        }

        .progress.visible {
            display: block;
        }

        .progress h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 25px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        @media (min-width: 480px) {
            .stats {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        .stat {
            text-align: center;
            padding: 10px 5px;
            background: #f5f5f5;
            border-radius: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #666;
            margin-top: 5px;
        }

        .channel-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
        }

        .channel-card.active {
            display: block;
        }

        .channel-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 480px) {
            .channel-header {
                flex-direction: row;
                align-items: flex-start;
            }
        }

        .avatar-container {
            flex-shrink: 0;
        }

        .channel-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #667eea;
            background: #f0f0f0;
        }

        @media (min-width: 480px) {
            .channel-avatar {
                width: 120px;
                height: 120px;
            }
        }

        .avatar-loading {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border: 3px solid #ccc;
        }

        @media (min-width: 480px) {
            .avatar-loading {
                width: 120px;
                height: 120px;
            }
        }

        .upload-prompt {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid #5568d3;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            font-weight: bold;
            font-size: 0.85rem;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            line-height: 1.3;
        }

        @media (min-width: 480px) {
            .upload-prompt {
                width: 120px;
                height: 120px;
                font-size: 0.95rem;
            }
        }

        .upload-prompt:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .upload-prompt:active {
            transform: scale(0.95);
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .channel-info {
            flex: 1;
            text-align: center;
        }

        @media (min-width: 480px) {
            .channel-info {
                text-align: left;
            }
        }

        .artist-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            word-wrap: break-word;
        }

        .channel-details {
            color: #666;
            line-height: 1.6;
            font-size: 0.9rem;
        }

        .channel-details div {
            margin-bottom: 5px;
            word-wrap: break-word;
        }

        .channel-details strong {
            color: #333;
        }

        .verification-methods {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 0.8rem;
            color: #666;
        }

        .verification-methods strong {
            display: block;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .method-status {
            margin: 5px 0;
            padding: 3px 0;
        }

        .method-success {
            color: #28a745;
        }

        .method-fail {
            color: #dc3545;
        }

        .buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        @media (min-width: 480px) {
            .buttons {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .btn {
            padding: 18px 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            touch-action: manipulation;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-good {
            background: #28a745;
            color: white;
        }

        .btn-bad {
            background: #dc3545;
            color: white;
        }

        .btn-review {
            background: #ffc107;
            color: #333;
        }

        .btn-skip {
            background: #6c757d;
            color: white;
        }

        .export-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .export-section.visible {
            display: block;
        }

        .export-section button {
            padding: 18px 30px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            touch-action: manipulation;
        }

        .export-section button:active {
            background: #218838;
            transform: scale(0.98);
        }

        .completion-message {
            background: white;
            padding: 30px 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        .completion-message.visible {
            display: block;
        }

        .completion-message h2 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .completion-message p {
            font-size: 0.95rem;
            color: #666;
        }

        .keyboard-hint {
            display: none;
            text-align: center;
            font-size: 0.75rem;
            color: #999;
            margin-top: 10px;
        }

        @media (min-width: 768px) {
            .keyboard-hint {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" id="uploadHeader">
            <h1>üé¨ YouTube Channel Verifier</h1>
            <p>Visual verification tool - see channel avatars and verify with one tap</p>
            
            <div class="upload-area" style="display: none;">
                <input type="file" id="fileInput" accept=".json">
                <textarea id="jsonPaste" placeholder="Or paste your JSON here..."></textarea>
                <button onclick="loadData()">Load Channels</button>
            </div>
        </div>

        <div class="progress" id="progress">
            <h3>Progress</h3>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="currentIndex">0</div>
                    <div class="stat-label">Current</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="totalChannels">0</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="goodCount">0</div>
                    <div class="stat-label">‚úì Good</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="badCount">0</div>
                    <div class="stat-label">‚úó Bad</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="reviewCount">0</div>
                    <div class="stat-label">? Review</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="skipCount">0</div>
                    <div class="stat-label">‚è≠ Skip</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%">
                    <span id="progressText">0%</span>
                </div>
            </div>
        </div>

        <div class="channel-card active" id="channelCard">
            <div class="channel-header">
                <div class="avatar-container">
                    <div class="upload-prompt" id="uploadPrompt" onclick="triggerUpload()">
                        Click here to upload JSON
                    </div>
                    <div class="avatar-loading" id="avatarLoading" style="display: none;"></div>
                    <img class="channel-avatar" id="channelAvatar" style="display: none;" alt="Channel Avatar">
                </div>
                <div class="channel-info">
                    <div class="artist-name" id="artistName">No Data Loaded</div>
                    <div class="channel-details">
                        <div><strong>Channel:</strong> <span id="channelTitle">-</span></div>
                        <div><strong>Channel ID:</strong> <span id="channelId">-</span></div>
                        <div><strong>Handle:</strong> <span id="channelHandle">-</span></div>
                    </div>
                </div>
            </div>

            <div class="verification-methods" id="methodsInfo" style="display: none;">
                <strong>Avatar Loading Status:</strong>
                <div class="method-status" id="method1">Method 1 (oEmbed): Trying...</div>
                <div class="method-status" id="method2">Method 2 (Direct CDN): Trying...</div>
                <div class="method-status" id="method3">Method 3 (Channel Page): Trying...</div>
            </div>

            <div class="buttons" style="display: none;" id="buttonContainer">
                <button class="btn btn-good" onclick="markChannel('good')">‚úì Good</button>
                <button class="btn btn-bad" onclick="markChannel('bad')">‚úó Bad</button>
                <button class="btn btn-review" onclick="markChannel('review')">? Review</button>
                <button class="btn btn-skip" onclick="markChannel('skip')">‚è≠ Skip</button>
            </div>
            
            <div class="keyboard-hint" style="display: none;" id="keyboardHint">
                üí° Desktop: Press 1/2/3/4 keys for faster verification
            </div>
        </div>

        <div class="completion-message" id="completionMessage">
            <h2>üéâ All Channels Verified!</h2>
            <p>You've reviewed all channels. Click below to download your results.</p>
        </div>

        <div class="export-section" id="exportSection">
            <button onclick="exportResults()">üì• Download Verified Channels (JSON)</button>
        </div>
    </div>

    <script>
        let originalChannels = [];
        let workingChannels = [];
        let currentIndex = 0;
        let stats = { good: 0, bad: 0, review: 0, skip: 0 };
        const STORAGE_KEY = 'youtube_verifier_data';
        const ORIGINAL_KEY = 'youtube_verifier_original';

        function triggerUpload() {
            const uploadArea = document.querySelector('.upload-area');
            uploadArea.style.display = 'block';
            document.getElementById('uploadHeader').classList.remove('has-data');
            document.getElementById('fileInput').click();
        }

        function loadSavedProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            const savedOriginal = localStorage.getItem(ORIGINAL_KEY);
            
            if (saved && savedOriginal) {
                try {
                    const data = JSON.parse(saved);
                    originalChannels = JSON.parse(savedOriginal);
                    workingChannels = data.channels;
                    currentIndex = data.currentIndex || 0;
                    stats = data.stats || { good: 0, bad: 0, review: 0, skip: 0 };
                    
                    document.getElementById('uploadHeader').classList.add('has-data');
                    document.getElementById('uploadPrompt').style.display = 'none';
                    document.getElementById('methodsInfo').style.display = 'block';
                    document.getElementById('buttonContainer').style.display = 'grid';
                    document.getElementById('keyboardHint').style.display = 'block';
                    
                    updateStats();
                    document.getElementById('totalChannels').textContent = workingChannels.length;
                    document.getElementById('progress').classList.add('visible');
                    
                    showChannel(currentIndex);
                    return true;
                } catch (error) {
                    console.error('Failed to load saved progress:', error);
                }
            }
            return false;
        }

        function saveProgress() {
            const data = {
                channels: workingChannels,
                currentIndex: currentIndex,
                stats: stats
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            localStorage.setItem(ORIGINAL_KEY, JSON.stringify(originalChannels));
        }

        function clearProgress() {
            localStorage.removeItem(STORAGE_KEY);
            localStorage.removeItem(ORIGINAL_KEY);
        }

        function updateStats() {
            document.getElementById('goodCount').textContent = stats.good;
            document.getElementById('badCount').textContent = stats.bad;
            document.getElementById('reviewCount').textContent = stats.review;
            document.getElementById('skipCount').textContent = stats.skip;
        }

        async function loadData() {
            const fileInput = document.getElementById('fileInput');
            const jsonPaste = document.getElementById('jsonPaste');

            let jsonText = '';

            if (fileInput.files.length > 0) {
                jsonText = await fileInput.files[0].text();
            } else if (jsonPaste.value.trim()) {
                jsonText = jsonPaste.value.trim();
            } else {
                alert('Please upload a file or paste JSON content');
                return;
            }

            try {
                const loadedData = JSON.parse(jsonText);
                
                originalChannels = JSON.parse(JSON.stringify(loadedData));
                
                workingChannels = loadedData
                    .filter(ch => ch.status === 'found' && ch.channel_id)
                    .map(ch => ({
                        ...ch,
                        verification_decision: null,
                        channel_url: null,
                        avatar_url: null,
                        avatar_method: null
                    }));
                
                if (workingChannels.length === 0) {
                    alert('No channels with "found" status in the JSON');
                    return;
                }

                currentIndex = 0;
                stats = { good: 0, bad: 0, review: 0, skip: 0 };
                
                document.getElementById('uploadHeader').classList.add('has-data');
                document.getElementById('uploadPrompt').style.display = 'none';
                document.getElementById('methodsInfo').style.display = 'block';
                document.getElementById('buttonContainer').style.display = 'grid';
                document.getElementById('keyboardHint').style.display = 'block';
                
                saveProgress();
                
                document.getElementById('progress').classList.add('visible');
                document.getElementById('totalChannels').textContent = workingChannels.length;
                
                showChannel(0);
            } catch (error) {
                alert('Invalid JSON: ' + error.message);
            }
        }

        async function showChannel(index) {
            if (index >= workingChannels.length) {
                document.getElementById('channelCard').classList.remove('active');
                document.getElementById('completionMessage').classList.add('visible');
                document.getElementById('exportSection').classList.add('visible');
                return;
            }

            const channel = workingChannels[index];
            currentIndex = index;

            document.getElementById('currentIndex').textContent = index + 1;
            const progressPercent = ((index) / workingChannels.length) * 100;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = Math.round(progressPercent) + '%';

            document.getElementById('channelCard').classList.add('active');
            
            document.getElementById('artistName').textContent = channel.artist || 'Unknown Artist';
            document.getElementById('channelTitle').textContent = channel.channel_title || 'N/A';
            document.getElementById('channelId').textContent = channel.channel_id;
            document.getElementById('channelHandle').textContent = channel.subscribers || 'N/A';

            document.getElementById('avatarLoading').style.display = 'block';
            document.getElementById('channelAvatar').style.display = 'none';
            document.getElementById('channelAvatar').src = '';

            document.getElementById('method1').textContent = 'Method 1 (oEmbed): Trying...';
            document.getElementById('method1').className = 'method-status';
            document.getElementById('method2').textContent = 'Method 2 (Direct CDN): Trying...';
            document.getElementById('method2').className = 'method-status';
            document.getElementById('method3').textContent = 'Method 3 (Channel Page): Trying...';
            document.getElementById('method3').className = 'method-status';

            const avatarData = await loadAvatar(channel.channel_id);
            
            if (avatarData) {
                channel.avatar_url = avatarData.url;
                channel.avatar_method = avatarData.method;
            }
        }

        async function loadAvatar(channelId) {
            let avatarUrl = null;
            let successMethod = null;

            try {
                const oEmbedUrl = `https://www.youtube.com/oembed?url=https://www.youtube.com/channel/${channelId}&format=json`;
                const response = await fetch(oEmbedUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.thumbnail_url) {
                        avatarUrl = data.thumbnail_url.replace('s48', 's176');
                        successMethod = 'oembed';
                        document.getElementById('method1').textContent = 'Method 1 (oEmbed): ‚úì Success';
                        document.getElementById('method1').className = 'method-status method-success';
                    }
                }
            } catch (error) {
                document.getElementById('method1').textContent = 'Method 1 (oEmbed): ‚úó Failed (CORS or network)';
                document.getElementById('method1').className = 'method-status method-fail';
            }

            if (!avatarUrl) {
                const patterns = [
                    `https://yt3.googleusercontent.com/ytc/${channelId}=s176-c-k-c0x00ffffff-no-rj`,
                    `https://yt3.googleusercontent.com/${channelId}=s176-c-k-c0x00ffffff-no-rj`,
                ];

                for (const pattern of patterns) {
                    try {
                        const testImg = new Image();
                        testImg.src = pattern;
                        
                        await new Promise((resolve) => {
                            testImg.onload = () => {
                                avatarUrl = pattern;
                                successMethod = 'cdn';
                                document.getElementById('method2').textContent = 'Method 2 (Direct CDN): ‚úì Success';
                                document.getElementById('method2').className = 'method-status method-success';
                                resolve();
                            };
                            testImg.onerror = () => resolve();
                            setTimeout(resolve, 1000);
                        });

                        if (avatarUrl) break;
                    } catch (error) {
                    }
                }

                if (!avatarUrl) {
                    document.getElementById('method2').textContent = 'Method 2 (Direct CDN): ‚úó Pattern not found';
                    document.getElementById('method2').className = 'method-status method-fail';
                }
            } else {
                document.getElementById('method2').textContent = 'Method 2 (Direct CDN): Skipped (Method 1 worked)';
                document.getElementById('method2').className = 'method-status';
            }

            if (!avatarUrl) {
                try {
                    const proxyUrl = 'https://api.allorigins.win/raw?url=';
                    const channelUrl = `https://www.youtube.com/channel/${channelId}`;
                    const response = await fetch(proxyUrl + encodeURIComponent(channelUrl));
                    
                    if (response.ok) {
                        const html = await response.text();
                        
                        const avatarMatch = html.match(/"avatar":\s*\{"thumbnails":\s*\[\{"url":"([^"]+)"/);
                        if (avatarMatch && avatarMatch[1]) {
                            avatarUrl = avatarMatch[1].replace('s48', 's176');
                            successMethod = 'scrape';
                            document.getElementById('method3').textContent = 'Method 3 (Channel Page): ‚úì Success';
                            document.getElementById('method3').className = 'method-status method-success';
                        }
                    }
                } catch (error) {
                    document.getElementById('method3').textContent = 'Method 3 (Channel Page): ‚úó Failed';
                    document.getElementById('method3').className = 'method-status method-fail';
                }
            } else {
                document.getElementById('method3').textContent = 'Method 3 (Channel Page): Skipped (earlier method worked)';
                document.getElementById('method3').className = 'method-status';
            }

            const avatarImg = document.getElementById('channelAvatar');
            const avatarLoading = document.getElementById('avatarLoading');

            if (avatarUrl) {
                avatarImg.src = avatarUrl;
                avatarImg.onload = () => {
                    avatarLoading.style.display = 'none';
                    avatarImg.style.display = 'block';
                };
                avatarImg.onerror = ()o => {
                    avatarLoading.style.display = 'none';
                    avatarImg.style.display = 'block';
                    avatarImg.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><rect fill="%23ccc" width="120" height="120"/><text x="50%" y="50%" fill="%23666" font-size="14" text-anchor="middle" dy=".3em">No Avatar</text></svg>';
                };
            } else {
                avatarLoading.style.display = 'none';
                avatarImg.style.display = 'block';
                avatarImg.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><rect fill="%23ccc" width="120" height="120"/><text x="50%" y="50%" fill="%23666" font-size="14" text-anchor="middle" dy=".3em">No Avatar</text></svg>';
            }

            return avatarUrl ? { url: avatarUrl, method: successMethod } : null;
        }

        function markChannel(decision) {
            const channel = workingChannels[currentIndex];
            
            channel.verification_decision = decision;
            
            if (decision === 'good') {
                channel.channel_url = `https://www.youtube.com/channel/${channel.channel_id}`;
            }

            stats[decision]++;
            updateStats();

            saveProgress();

            showChannel(currentIndex + 1);
        }

        function exportResults() {
            const output = originalChannels.map(original => {
                const verified = workingChannels.find(w => 
                    w.channel_id === original.channel_id && 
                    w.artist === original.artist
                );
                
                if (verified && verified.verification_decision) {
                    return {
                        ...original,
                        verification_decision: verified.verification_decision,
                        channel_url: verified.channel_url || null,
                        avatar_url: verified.avatar_url || null,
                        avatar_method: verified.avatar_method || null
                    };
                }
                
                return original;
            });
            
            const dataStr = JSON.stringify(output, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'channels_verified_' + new Date().toISOString().slice(0,10) + '.json';
            link.click();
            URL.revokeObjectURL(url);
            
            clearProgress();
        }

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('channelCard').classList.contains('active')) {
                if (e.key === '1') markChannel('good');
                if (e.key === '2') markChannel('bad');
                if (e.key === '3') markChannel('review');
                if (e.key === '4') markChannel('skip');
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            if (loadSavedProgress()) {
                console.log('Resumed saved progress from previous session');
            }
        });
    </script>
</body>
</html>
